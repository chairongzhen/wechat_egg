<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>百度地图api学习</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
	    body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
	</style>
    <!-- 将百度地图API引入，设置好自己的key -->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=IUH39YOMVwr2K1mPnH8KQjaZ23XxnDNX"></script>
    <script src="../js/block.js" ></script>
</head>
<body>
    <div id="allmap"></div>
</body>
</html>
<script type="text/javascript">
    let map = new BMap.Map("allmap"); 
    map.centerAndZoom(new BMap.Point(121.487899486, 31.24916171), 12);  // 初始化地图,设置中心点坐标和地图级别
	//添加地图类型控件
	map.addControl(new BMap.MapTypeControl({
		mapTypes:[
            BMAP_NORMAL_MAP
        ]}));	  
	map.setCurrentCity("上海");          // 设置地图显示的城市 此项是必须设置的
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
    map.disableDoubleClickZoom();
    addMapControl();
    console.log(block);

    function addMapControl() {
        var top_right_conntrol = new BMap.ScaleControl({ anchor: window.BMAP_ANCHOR_TOP_RIGHT });
        var top_right_navigation = new BMap.NavigationControl({ anchor: window.BMAP_ANCHOR_TOP_RIGHT });
        map.addControl(top_right_conntrol);
        map.addControl(top_right_navigation);
        drawDistCircle("上海市");
    }

    function drawDistCircle(city) {
        for(let c of block) {
            if(c.city === city) {
                for(let dis of c.distict) {
                    _addDistrictCircle(dis.location.lng,dis.location.lat,dis.name,Math.ceil(Math.random()*1000));
                }
            }
        }
    }

    function _addDistrictCircle(lng,lat,showname,num) {
        let point = new BMap.Point(lng,lat);
        let circle = new BMap.Circle(point, 2000, { fillColor: "green", strokeWeight: 1 });
        map.addOverlay(circle);
        _setLabels("distict",point, -15, -20,showname, showname);
        _setLabels("distict",point, -15, 0, showname,num + "家");
    }
    function _setLabels(type,point, offsetx, offsety, showname,content) {
        var opts = {
            position: point,    // 指定文本标注所在的地理位置
            offset: new BMap.Size(offsetx, offsety)    //设置文本偏移量
        }
        var label = new BMap.Label(content, opts); 
        label.setStyle({
            color: "white",
            backgroundColor: "transparent",
            border: "0px",
            fontSize: "13px",
            cursor: "pointer"
        });
        map.addOverlay(label);

    }
</script>
